<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GINA - Grow INdigenous trees in your Area</title>
  <link rel="icon" type="image/x-icon" href="./assets/img/gina-icon.ico">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="./assets/css/login.css" rel="stylesheet">
</head>

<body class="bg-green-200">
    <form action="" method="post">
        <div class="imgcontainer">
          <img src="./assets/img/gina.png" alt="Avatar" class="h-20 w-30 mr-4 center">
        </div>
        <h1 class="text-green-400 text-2xl font-bold">Login to your account</h2>
        <div class="container">
          <label for="uname"><b>Username</b></label><br>
          <input type="text" placeholder="Enter Username" name="uname" required class="w-50 p-2 rounded-xl"><br>
      
          <label for="psw"><b>Password</b></label><br>
          <input type="password" placeholder="Enter Password" name="psw" required class="w-50 p-2 rounded-xl"><br>
      
          <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-xl">Login</button><br>
          <label>
            <input type="checkbox" name="remember"> Remember me
          </label>
        </div>
        <div class="imgcontainer">
            <p class="text-green-600 text-lg"> - or login with -</p><br>
            <button type="button">
                <a href="#" class="fb p-2 rounded-xl">
                    <i class="fa fa-facebook fa-fw rounded-xl"></i>
                  </a>
            </button>
            <button type="button">
                <a href="#" class="google p-2 rounded-xl ml-2">
                    <i class="fa fa-google fa-fw rounded-xl"></i>
                  </a>
            </button>
          </div>
      
        <div class="container">
          <span class="center text-green-600">Register as an <a href="signup.html" class="hover:rounded-full hover:bg-gray-300"><u>individual?</u></a></span>
        </div>
      </form>

      <script>
        let url = "d92b-110-54-133-136.ngrok-free.app";
        let loginURL = `https://${url}/auth/token/login/`;

        // Check if user has an authToken saved
        const authToken = localStorage.getItem('authToken');
        const rememberMe = localStorage.getItem('rememberMe');

        if (authToken && rememberMe) {
          // User has an authToken saved, automatically log them in
          console.log('Auth token found:', authToken);
          window.location.href = 'learn.html';
        } else {
          // User doesn't have an authToken saved, show the login form
          const form = document.querySelector('form');

          form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const username = document.querySelector('input[name="uname"]').value;
          const password = document.querySelector('input[name="psw"]').value;
          const rememberMe = document.querySelector('input[name="remember"]').checked;

          const response = await fetch(loginURL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              username,
              password,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            // Login successful, save the auth token
            const authToken = data.auth_token;

            if (rememberMe) {
              // Remember me is checked, store the auth token in local storage
              localStorage.setItem('authToken', authToken);
              localStorage.setItem('username', username);
            } else {
              // Remember me is not checked, store the auth token in session storage
              sessionStorage.setItem('authToken', authToken);
              sessionStorage.setItem('username', username);
            }

            console.log('Auth token saved:', authToken);

            // Open learn.html
            window.location.href = 'learn.html';
          } else {
            // Login failed, handle the error
            console.error(data);
          }
        });
        }


        
      </script>
  </body>
  </html>